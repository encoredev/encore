---
seotitle: Using Prisma with Encore.ts
seodesc: Learn how to use Prisma with Encore to interact with SQL databases.
title: Using Prisma with Encore.ts
lang: ts
---

[Prisma](https://prisma.io/) is a modern TypeScript ORM that provides type-safe database access and migrations. With Prisma, you define your database schema in a `schema.prisma` file and use Prisma's CLI to generate SQL migrations and a TypeScript client.

This guide explains how to integrate Prisma with Encore.ts, leveraging Encore's built-in database management while using Prisma's powerful ORM features.

## How Prisma works with Encore

Encore and Prisma work together seamlessly:
- **Prisma** generates the migration files and TypeScript client
- **Encore** manages database creation, connections, and applies migrations
- You use Encore's `SQLDatabase` to provide connection strings to Prisma

The key to this integration is configuring Prisma to use Encore's shadow database for its operations, preventing any conflicts between the two systems.

## Quick Example

Here's a complete example of using Prisma with Encore.ts:

```ts
-- database.ts --
import { SQLDatabase } from "encore.dev/storage/sqldb";
import { PrismaClient } from "./prisma/client";
import { PrismaPg } from "@prisma/adapter-pg";

// Define a database named 'myapp', using the database migrations
// in the "./prisma/migrations" folder (generated by Prisma).
// Set `source` to `prisma` to indicate migrations are Prisma-generated.
const DB = new SQLDatabase("myapp", {
  migrations: {
    path: "./prisma/migrations",
    source: "prisma",
  },
});

// Create Prisma client with Encore's connection string
export const prisma = new PrismaClient({
  adapter: new PrismaPg({ connectionString: DB.connectionString }),
});

// Example usage
export async function getUsers() {
  return await prisma.user.findMany();
}

-- prisma/schema.prisma --
generator client {
  provider        = "prisma-client-js"
  output          = "./generated"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  // Connect Prisma CLI to Encore's shadow database
  // This prevents interference with Encore's migration system
  url      = env("SHADOW_DB_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  createdAt DateTime @default(now())
}

-- prisma/client.ts --
// Re-export the generated client for cleaner imports
export * from "./generated/index";
```

<GitHubLink
href="https://github.com/encoredev/examples/tree/main/ts/prisma"
desc="Complete Prisma + Encore.ts example"
/>

## Step-by-Step Setup

### 1. Install Dependencies

First, install Prisma and its required dependencies:

```bash
npm install prisma --save-dev
npm install @prisma/client @prisma/adapter-pg dotenv --save
```

### 2. Configure Database Connections

Prisma needs to connect to Encore's shadow database for migration operations. The shadow database is a temporary database that Prisma uses to detect schema drift and generate migrations without affecting your main database.

Get the connection strings for both databases:

```bash
# Main database connection (for Prisma Studio)
encore db conn-uri <database-name>

# Shadow database connection (for Prisma CLI operations)
encore db conn-uri <database-name> --shadow
```

Create a `.env` file in your project root:

```env
# Connection strings for local development
DB_URL=<main-database-connection-string>
SHADOW_DB_URL=<shadow-database-connection-string>
```

### 3. Create Prisma Configuration

Create a `prisma.config.ts` file in your project root to configure Prisma:

```ts
import "dotenv/config";
import type { PrismaConfig } from "prisma";
import { PrismaPg } from "@prisma/adapter-pg";

type Env = {
  DB_URL: string;
};

export default {
  earlyAccess: true,
  schema: "./prisma/schema.prisma",
  studio: {
    adapter: async (env: Env) => {
      // Connect Prisma Studio to the main Encore database
      return new PrismaPg({ connectionString: env.DB_URL });
    },
  },
} satisfies PrismaConfig<Env>;
```

### 4. Create Your Prisma Schema

Create a `prisma/schema.prisma` file to define your database schema:

```prisma
generator client {
  provider        = "prisma-client-js"
  output          = "./generated"
  previewFeatures = ["queryCompiler", "driverAdapters"]
}

datasource db {
  provider = "postgresql"
  // IMPORTANT: Use shadow database URL for Prisma CLI operations
  url      = env("SHADOW_DB_URL")
}

// Define your models here
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  posts     Post[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Post {
  id        Int      @id @default(autoincrement())
  title     String
  content   String?
  published Boolean  @default(false)
  author    User     @relation(fields: [authorId], references: [id])
  authorId  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

### 5. Create Database Configuration

Create your Encore database configuration file that uses Prisma migrations:

```ts
// services/db/database.ts
import { SQLDatabase } from "encore.dev/storage/sqldb";
import { PrismaClient } from "./prisma/client";
import { PrismaPg } from "@prisma/adapter-pg";

// Create the database with Prisma migrations
const DB = new SQLDatabase("myapp", {
  migrations: {
    path: "./prisma/migrations",
    source: "prisma",
  },
});

// Initialize Prisma client
export const prisma = new PrismaClient({
  adapter: new PrismaPg({ connectionString: DB.connectionString }),
});

```

### 6. Create Client Export

Create a `prisma/client.ts` file for cleaner imports:

```ts
// Re-export everything from the generated client
export * from "./generated/index";
```

## Working with Migrations

### Generate Migrations

When you make changes to your `schema.prisma` file, generate a new migration:

```bash
npx prisma migrate dev --name <migration-name>
```

This command:
1. Compares your schema with the current database state
2. Generates SQL migration files in `prisma/migrations/`
3. Applies the migration to your development database
4. Regenerates the Prisma client

**Example:**
```bash
npx prisma migrate dev --name add-user-table
```

### How Migrations Work

- **Prisma generates** the SQL migration files based on your schema changes
- **Encore applies** these migrations automatically:
  - Locally when you run `encore run`
  - In cloud environments during deployment
  - During tests when using `encore test`

You don't need to manually run migrations - Encore handles this for you!

## Deployment Considerations

### Generate Client Code

For Encore Cloud deployments, ensure the Prisma client is generated. You have two options:

**Option 1: Auto-generate on install**

Add to your `package.json`:

```json
{
  "scripts": {
    "postinstall": "npx prisma generate"
  }
}
```

**Option 2: Commit generated files**

If you prefer to commit the generated client to your repository:
1. Run `npx prisma generate` locally
2. Commit the `prisma/generated/` directory

### Environment Variables

In production, Encore automatically provides database connection strings. You don't need to configure environment variables for production deployments.

## Using Prisma Studio

Prisma Studio provides a visual interface for viewing and editing your database:

```bash
npx prisma studio
```

This will open a web interface at `http://localhost:5555` where you can:
- Browse your data
- Create, update, and delete records
- Test your relationships

## Common Issues and Solutions

### Connection Issues

If Prisma or Prisma Studio can't connect to the database:
1. Verify your `.env` file has the correct connection strings
2. Ensure you're running `encore run` to start the local database
3. Check that the database name matches in both Encore and Prisma configurations
