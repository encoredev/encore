-- code.go --
package code

import "context"

//encore:api public path=/!fallback
func Foo(ctx context.Context, fallback string) error { return nil }
-- want:codewrappers/wrappers.go --
package codewrappers

import __api "encore.dev/appruntime/apisdk/api"

type EncoreInternal_FooReq struct {
	P0 string
}

type EncoreInternal_FooResp = __api.Void
-- want:encore.gen.go --
// Code generated by encore. DO NOT EDIT.

package code

import "context"

// These functions are automatically generated and maintained by Encore
// to simplify calling them from other services, as they were implemented as methods.
// They are automatically updated by Encore whenever your API endpoints change.

// Interface defines the service's API surface area, primarily for mocking purposes.
//
// Raw endpoints are currently excluded from this interface, as Encore does not yet
// support service-to-service API calls to raw endpoints.
type Interface interface {
	Foo(ctx context.Context, fallback string) error
}
-- want:encore_internal__api.go --
package code

import (
	"context"
	__api "encore.dev/appruntime/apisdk/api"
	__etype "encore.dev/appruntime/shared/etype"
	codewrappers "example.com/codewrappers"
	jsoniter "github.com/json-iterator/go"
	"net/http"
	"net/url"
	"strings"
)

func init() {
	__api.RegisterEndpoint(EncoreInternal_api_APIDesc_Foo, Foo)
}

var EncoreInternal_api_APIDesc_Foo = &__api.Desc[*codewrappers.EncoreInternal_FooReq, codewrappers.EncoreInternal_FooResp]{
	Access: __api.Public,
	AppHandler: func(ctx context.Context, reqData *codewrappers.EncoreInternal_FooReq) (codewrappers.EncoreInternal_FooResp, error) {
		err := Foo(ctx, reqData.P0)
		if err != nil {
			return __api.Void{}, err
		}
		return __api.Void{}, nil
	},
	CloneReq: func(r *codewrappers.EncoreInternal_FooReq) (*codewrappers.EncoreInternal_FooReq, error) {
		var clone *codewrappers.EncoreInternal_FooReq
		bytes, err := jsoniter.ConfigDefault.Marshal(r)
		if err == nil {
			err = jsoniter.ConfigDefault.Unmarshal(bytes, &clone)
		}
		return clone, err
	},
	CloneResp: func(r codewrappers.EncoreInternal_FooResp) (codewrappers.EncoreInternal_FooResp, error) {
		var clone codewrappers.EncoreInternal_FooResp
		bytes, err := jsoniter.ConfigDefault.Marshal(r)
		if err == nil {
			err = jsoniter.ConfigDefault.Unmarshal(bytes, &clone)
		}
		return clone, err
	},
	DecodeExternalResp: func(httpResp *http.Response, json jsoniter.API) (resp codewrappers.EncoreInternal_FooResp, err error) {
		return __api.Void{}, nil
	},
	DecodeReq: func(httpReq *http.Request, ps __api.UnnamedParams, json jsoniter.API) (reqData *codewrappers.EncoreInternal_FooReq, pathParams __api.UnnamedParams, err error) {
		reqData = new(codewrappers.EncoreInternal_FooReq)
		dec := new(__etype.Unmarshaller)
		// Trim the leading slash from wildcard parameter, as Encore's semantics excludes it,
		// while the httprouter implementation includes it.
		ps[0] = strings.TrimPrefix(ps[0], "/")

		if value, err := url.PathUnescape(ps[0]); err == nil {
			ps[0] = value
		}
		reqData.P0 = __etype.UnmarshalOne(dec, __etype.UnmarshalString, "fallback", ps[0], true)
		if err := dec.Error; err != nil {
			return nil, nil, err
		}
		return reqData, ps, nil
	},
	DefLoc: uint32(0x0),
	EncodeExternalReq: func(reqData *codewrappers.EncoreInternal_FooReq, stream *jsoniter.Stream) (httpHeader http.Header, queryString url.Values, err error) {
		return nil, nil, nil
	},
	EncodeResp: func(w http.ResponseWriter, json jsoniter.API, resp codewrappers.EncoreInternal_FooResp, status int) (err error) {
		return nil
	},
	Endpoint:            "Foo",
	Fallback:            true,
	GlobalMiddlewareIDs: []string{},
	Methods:             []string{"GET", "POST"},
	Path:                "/!fallback",
	PathParamNames:      []string{"fallback"},
	Raw:                 false,
	RawHandler:          nil,
	RawPath:             "/*0",
	ReqPath: func(reqData *codewrappers.EncoreInternal_FooReq) (string, __api.UnnamedParams, error) {
		params := __api.UnnamedParams{__etype.MarshalOne(__etype.MarshalString, reqData.P0)}
		return "/" + url.PathEscape(params[0]), params, nil
	},
	ReqUserPayload: func(reqData *codewrappers.EncoreInternal_FooReq) any {
		return nil
	},
	Service:           "code",
	ServiceMiddleware: []*__api.Middleware{},
	SvcNum:            1,
	Tags:              nil,
}
