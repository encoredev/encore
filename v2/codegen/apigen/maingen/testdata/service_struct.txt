-- code.go --
package code

import "context"

//encore:service
type Service struct{}

//encore:api
func (s *Service) Foo(ctx context.Context) error { return nil }

func initService() (*Service, error) { return nil, nil }

-- want:__encore/main/main.go --
package main

import (
	__api "encore.dev/appruntime/api"
	__appinit "encore.dev/appruntime/app/appinit"
	__config "encore.dev/appruntime/config"
	__service "encore.dev/appruntime/service"
	examplecom "example.com"
	_ "unsafe"
)

// loadApp loads the Encore app runtime.
//
//go:linkname loadApp encore.dev/appruntime/app/appinit.load
func loadApp() *__appinit.LoadData {
	static := &__config.Static{
		AppCommit: __config.CommitInfo{
			Revision:    "",
			Uncommitted: false,
		},
		AuthData:          nil,
		BundledServices:   []string{"code"},
		CORSAllowHeaders:  nil,
		CORSExposeHeaders: nil,
		EncoreCompiler:    "",
		PubsubTopics:      map[string]*__config.StaticPubsubTopic{},
		TestService:       "",
		Testing:           false,
	}
	handlers := []__api.HandlerRegistration{
		{
			Handler:    examplecom.EncoreInternal_api_APIDesc_Foo,
			Middleware: nil,
		},
	}
	return &__appinit.LoadData{
		APIHandlers: handlers,
		AuthHandler: nil,
		ServiceInit: []__service.Initializer{
			examplecom.EncoreInternal_svcstruct_Service,
		},
		StaticCfg: static,
	}
}
func main() {
	__appinit.AppMain()
}
-- want:code.go --
package code

import _ "encore.dev/appruntime/app/appinit"
/*line :3:1*/import "context"

//encore:service
type Service struct{}

//encore:api
func (s *Service) Foo(ctx context.Context) error { return nil }

func initService() (*Service, error) { return nil, nil }

-- want:encore.gen.go --
// Code generated by encore. DO NOT EDIT.

package code

import "context"

// These functions are automatically generated and maintained by Encore
// to simplify calling them from other services, as they were implemented as methods.
// They are automatically updated by Encore whenever your API endpoints change.

func Foo(ctx context.Context) error {
	svc, err := EncoreInternal_svcstruct_Service.Get()
	if err != nil {
		return err
	}
	return svc.Foo(ctx)
}
-- want:encore_internal__api.go --
package code

import (
	"context"
	__api "encore.dev/appruntime/api"
	jsoniter "github.com/json-iterator/go"
	"net/http"
)

type EncoreInternal_FooReq struct{}

type EncoreInternal_FooResp = __api.Void

var EncoreInternal_api_APIDesc_Foo = &__api.Desc[*EncoreInternal_FooReq, EncoreInternal_FooResp]{
	Access: __api.Private,
	AppHandler: func(ctx context.Context, reqData *EncoreInternal_FooReq) (EncoreInternal_FooResp, error) {
		svc, initErr := EncoreInternal_svcstruct_Service.Get()
		if initErr != nil {
			return __api.Void{}, initErr
		}
		err := svc.Foo(ctx)
		if err != nil {
			return __api.Void{}, err
		}
		return __api.Void{}, nil
	},
	CloneReq: func(r *EncoreInternal_FooReq) (*EncoreInternal_FooReq, error) {
		var clone *EncoreInternal_FooReq
		bytes, err := jsoniter.ConfigDefault.Marshal(r)
		if err == nil {
			err = jsoniter.ConfigDefault.Unmarshal(bytes, &clone)
		}
		return clone, err
	},
	CloneResp: func(r EncoreInternal_FooResp) (EncoreInternal_FooResp, error) {
		var clone EncoreInternal_FooResp
		bytes, err := jsoniter.ConfigDefault.Marshal(r)
		if err == nil {
			err = jsoniter.ConfigDefault.Unmarshal(bytes, &clone)
		}
		return clone, err
	},
	DecodeReq: func(httpReq *http.Request, ps __api.UnnamedParams, json jsoniter.API) (reqData *EncoreInternal_FooReq, pathParams __api.UnnamedParams, err error) {
		reqData = new(EncoreInternal_FooReq)
		return reqData, nil, nil
	},
	DefLoc: int32(0),
	EncodeResp: func(w http.ResponseWriter, json jsoniter.API, resp EncoreInternal_FooResp) (err error) {
		return nil
	},
	Endpoint:       "Foo",
	Methods:        []string{"GET", "POST"},
	Path:           "/code.Foo",
	PathParamNames: nil,
	Raw:            false,
	RawHandler:     nil,
	RawPath:        "/code.Foo",
	ReqPath: func(reqData *EncoreInternal_FooReq) (string, __api.UnnamedParams, error) {
		return "/code.Foo", nil, nil
	},
	ReqUserPayload: func(reqData *EncoreInternal_FooReq) any {
		return nil
	},
	Service: "code",
	SvcNum:  0,
}
-- want:encore_internal__svcstruct.go --
package code

import __service "encore.dev/appruntime/service"

var EncoreInternal_svcstruct_Service = &__service.Decl[Service]{
	Name:        "Service",
	Service:     "code",
	Setup:       initService,
	SetupDefLoc: int32(0),
}
